{

"nameKey": "pipeline.lomo.name",
"descriptionKey": "pipeline.canvas_basic.desc",

"include": [
	"canvas:pipeline/basic_light_config.json",
	"canvas:pipeline/fog_config.json",
	"canvas:pipeline/handheld_light_config.json"
],

"materialProgram": {
	"vertexSource": "lomo:shaders/pipeline/lomo.vert",
	"fragmentSource": "lomo:shaders/pipeline/lomo.frag"
},

"drawTargets": {
	"solidTerrain": "solid_with_depth_and_normal",
	"translucentTerrain": "translucent_0_cnd",
	"translucentEntity": "translucent_1_cnd",
	"weather": "solid_with_depth_and_normal",
	"clouds": "solid_with_depth_and_normal",
	"translucentParticles": "translucent_1_cnd"
},

"fabulousTargets": {
	"entity": "translucent_1_cnd",
	"particles": "translucent_1_cnd",
	"weather": "translucent_1_cnd",
	"clouds": "translucent_1_cd",
	"translucent": "translucent_1_cd"
},

"defaultFramebuffer": "solid_with_depth",

"programs": [
	{
		"name": "copy",
		"vertexSource": "lomo:shaders/pipeline/full_frame_depth_1.vert",
		"fragmentSource": "lomo:shaders/pipeline/copy.frag",
		"samplers": [ "u_input" ]
	},
	{
		"name": "copy_with_depth",
		"vertexSource": "lomo:shaders/pipeline/full_frame_depth_1.vert",
		"fragmentSource": "lomo:shaders/pipeline/copy_with_depth.frag",
		"samplers": [ "u_input", "u_input_depth" ]
	},
	{
		"name": "sort",
		"vertexSource": "lomo:shaders/pipeline/full_frame_depth_1.vert",
		"fragmentSource": "lomo:shaders/pipeline/sort.frag",
		"samplers": [
			"u_solid", "u_solid_normal", "u_solid_depth",
			"u_translucent_0", "u_translucent_0_normal", "u_translucent_0_depth",
			"u_translucent_1", "u_translucent_1_normal", "u_translucent_1_depth"
		]
	},
	{
		"name": "copy_2_depth",
		"vertexSource": "lomo:shaders/pipeline/full_frame_depth_1.vert",
		"fragmentSource": "lomo:shaders/pipeline/copy_2_depth.frag",
		"samplers": [ "u_depth_0", "u_depth_1" ]
	},
	{
		"name": "depth_levels_4",
		"vertexSource": "lomo:shaders/pipeline/full_frame_depth_1.vert",
		"fragmentSource": "lomo:shaders/pipeline/depth_levels_4.frag",
		"samplers": [ "u_depth_0", "u_depth_1" ]
	},
	{
		"name": "post",
		"vertexSource": "lomo:shaders/pipeline/full_frame_depth_1.vert",
		"fragmentSource": "lomo:shaders/pipeline/post.frag",
		"samplers": [
			"u_solid", "u_solid_normal", "u_solid_depth",
			"u_sorted", "u_sorted_normal", "u_sorted_depth"
		]
	}
],

"fabulous": {
	"passes": [
		{
			"name": "sort",
			"program": "sort",
			"framebuffer": "sorted",
			"samplerImages": [
				"solid", "solid_normal", "solid_depth",
				"translucent_0", "translucent_0_normal", "translucent_0_depth",
				"translucent_1", "translucent_1_normal", "translucent_1_depth"
			]
		},
		{
			"name": "depth_0",
			"program": "copy_2_depth",
			"framebuffer": "depth_level_0",
			"samplerImages": [ "sorted_depth", "solid_depth" ],
			"lod": 0
		},
		{
			"name": "depth_1",
			"program": "depth_levels_4",
			"framebuffer": "depth_level_1",
			"samplerImages": [ "depth_levels", "solid_depth_levels" ],
			"lod": 1
		},
		{
			"name": "depth_2",
			"program": "depth_levels_4",
			"framebuffer": "depth_level_2",
			"samplerImages": [ "depth_levels", "solid_depth_levels" ],
			"lod": 2
		},
		{
			"name": "depth_3",
			"program": "depth_levels_4",
			"framebuffer": "depth_level_3",
			"samplerImages": [ "depth_levels", "solid_depth_levels" ],
			"lod": 3
		},
		{
			"name": "depth_4",
			"program": "depth_levels_4",
			"framebuffer": "depth_level_4",
			"samplerImages": [ "depth_levels", "solid_depth_levels" ],
			"lod": 4
		},
		{
			"name": "post",
			"program": "post",
			"framebuffer": "post_result",
			"samplerImages": [
				"solid", "solid_normal", "solid_depth_levels",
				"sorted", "sorted_normal", "depth_levels"
			]
		},
		{
			"name": "copy_result",
			"program": "copy",
			"framebuffer": "solid",
			"samplerImages": [
				"post_result"
			]
		}
	]
},

"images": [
	{
		"name": "solid",
		"texParams": [
			{ "name": "TEXTURE_MIN_FILTER", "val": "NEAREST" },
			{ "name": "TEXTURE_MAG_FILTER", "val": "NEAREST" },
			{ "name": "TEXTURE_WRAP_S", "val": "CLAMP_TO_EDGE" },
			{ "name": "TEXTURE_WRAP_T", "val": "CLAMP_TO_EDGE" }
		]
	},
	{
		"name": "post_result",
		"texParams": [
			{ "name": "TEXTURE_MIN_FILTER", "val": "NEAREST" },
			{ "name": "TEXTURE_MAG_FILTER", "val": "NEAREST" },
			{ "name": "TEXTURE_WRAP_S", "val": "CLAMP_TO_EDGE" },
			{ "name": "TEXTURE_WRAP_T", "val": "CLAMP_TO_EDGE" }
		]
	},
	{
		"name": "solid_normal",
		"internalFormat": "GL_RGBA16F",
		"pixelFormat": "RGBA",
		"pixelDataType": "FLOAT",
		"texParams": [
			{ "name": "TEXTURE_MIN_FILTER", "val": "NEAREST" },
			{ "name": "TEXTURE_MAG_FILTER", "val": "NEAREST" },
			{ "name": "TEXTURE_WRAP_S", "val": "CLAMP_TO_EDGE" },
			{ "name": "TEXTURE_WRAP_T", "val": "CLAMP_TO_EDGE" }
		]
	},
	{
		"name": "solid_depth",
		"internalFormat": "DEPTH_COMPONENT",
		"pixelFormat": "DEPTH_COMPONENT",
		"pixelDataType": "FLOAT",
		"texParams": [
			{ "name": "TEXTURE_MIN_FILTER", "val": "NEAREST" },
			{ "name": "TEXTURE_MAG_FILTER", "val": "NEAREST" },
			{ "name": "TEXTURE_WRAP_S", "val": "CLAMP_TO_EDGE" },
			{ "name": "TEXTURE_WRAP_T", "val": "CLAMP_TO_EDGE" },
			{ "name": "TEXTURE_COMPARE_MODE", "val": "NONE" }
		]
	},
	{
		"name": "translucent_0",
		"texParams": [
			{ "name": "TEXTURE_MIN_FILTER", "val": "NEAREST" },
			{ "name": "TEXTURE_MAG_FILTER", "val": "NEAREST" },
			{ "name": "TEXTURE_WRAP_S", "val": "CLAMP_TO_EDGE" },
			{ "name": "TEXTURE_WRAP_T", "val": "CLAMP_TO_EDGE" }
		]
	},
	{
		"name": "translucent_0_normal",
		"internalFormat": "GL_RGBA16F",
		"pixelFormat": "RGBA",
		"pixelDataType": "FLOAT",
		"texParams": [
			{ "name": "TEXTURE_MIN_FILTER", "val": "NEAREST" },
			{ "name": "TEXTURE_MAG_FILTER", "val": "NEAREST" },
			{ "name": "TEXTURE_WRAP_S", "val": "CLAMP_TO_EDGE" },
			{ "name": "TEXTURE_WRAP_T", "val": "CLAMP_TO_EDGE" }
		]
	},
	{
		"name": "translucent_0_depth",
		"internalFormat": "DEPTH_COMPONENT",
		"pixelFormat": "DEPTH_COMPONENT",
		"pixelDataType": "FLOAT",
		"texParams": [
			{ "name": "TEXTURE_MIN_FILTER", "val": "NEAREST" },
			{ "name": "TEXTURE_MAG_FILTER", "val": "NEAREST" },
			{ "name": "TEXTURE_WRAP_S", "val": "CLAMP_TO_EDGE" },
			{ "name": "TEXTURE_WRAP_T", "val": "CLAMP_TO_EDGE" },
			{ "name": "TEXTURE_COMPARE_MODE", "val": "NONE" }
		]
	},
	{
		"name": "translucent_1",
		"texParams": [
			{ "name": "TEXTURE_MIN_FILTER", "val": "NEAREST" },
			{ "name": "TEXTURE_MAG_FILTER", "val": "NEAREST" },
			{ "name": "TEXTURE_WRAP_S", "val": "CLAMP_TO_EDGE" },
			{ "name": "TEXTURE_WRAP_T", "val": "CLAMP_TO_EDGE" }
		]
	},
	{
		"name": "translucent_1_normal",
		"internalFormat": "GL_RGBA16F",
		"pixelFormat": "RGBA",
		"pixelDataType": "FLOAT",
		"texParams": [
			{ "name": "TEXTURE_MIN_FILTER", "val": "NEAREST" },
			{ "name": "TEXTURE_MAG_FILTER", "val": "NEAREST" },
			{ "name": "TEXTURE_WRAP_S", "val": "CLAMP_TO_EDGE" },
			{ "name": "TEXTURE_WRAP_T", "val": "CLAMP_TO_EDGE" }
		]
	},
	{
		"name": "translucent_1_depth",
		"internalFormat": "DEPTH_COMPONENT",
		"pixelFormat": "DEPTH_COMPONENT",
		"pixelDataType": "FLOAT",
		"texParams": [
			{ "name": "TEXTURE_MIN_FILTER", "val": "NEAREST" },
			{ "name": "TEXTURE_MAG_FILTER", "val": "NEAREST" },
			{ "name": "TEXTURE_WRAP_S", "val": "CLAMP_TO_EDGE" },
			{ "name": "TEXTURE_WRAP_T", "val": "CLAMP_TO_EDGE" },
			{ "name": "TEXTURE_COMPARE_MODE", "val": "NONE" }
		]
	},
	{
		"name": "sorted",
		"texParams": [
			{ "name": "TEXTURE_MIN_FILTER", "val": "NEAREST" },
			{ "name": "TEXTURE_MAG_FILTER", "val": "NEAREST" },
			{ "name": "TEXTURE_WRAP_S", "val": "CLAMP_TO_EDGE" },
			{ "name": "TEXTURE_WRAP_T", "val": "CLAMP_TO_EDGE" }
		]
	},
	{
		"name": "sorted_normal",
		"internalFormat": "GL_RGBA16F",
		"pixelFormat": "RGBA",
		"pixelDataType": "FLOAT",
		"texParams": [
			{ "name": "TEXTURE_MIN_FILTER", "val": "NEAREST" },
			{ "name": "TEXTURE_MAG_FILTER", "val": "NEAREST" },
			{ "name": "TEXTURE_WRAP_S", "val": "CLAMP_TO_EDGE" },
			{ "name": "TEXTURE_WRAP_T", "val": "CLAMP_TO_EDGE" }
		]
	},
	{
		"name": "sorted_depth",
		"internalFormat": "GL_R32F",
		"pixelFormat": "RED",
		"pixelDataType": "FLOAT",
		"texParams": [
			{ "name": "TEXTURE_MIN_FILTER", "val": "NEAREST" },
			{ "name": "TEXTURE_MAG_FILTER", "val": "NEAREST" },
			{ "name": "TEXTURE_WRAP_S", "val": "CLAMP_TO_EDGE" },
			{ "name": "TEXTURE_WRAP_T", "val": "CLAMP_TO_EDGE" },
			{ "name": "TEXTURE_COMPARE_MODE", "val": "NONE" }
		]
	},
	{
		"name": "depth_levels",
		"lod": 4,
		"internalFormat": "GL_R32F",
		"pixelFormat": "RED",
		"pixelDataType": "FLOAT",
		"texParams": [
			{ "name": "TEXTURE_MIN_FILTER", "val": "NEAREST_MIPMAP_NEAREST"},
			{ "name": "TEXTURE_MAG_FILTER", "val": "NEAREST"},
			{ "name": "TEXTURE_WRAP_S", "val": "CLAMP_TO_EDGE"},
			{ "name": "TEXTURE_WRAP_T", "val": "CLAMP_TO_EDGE"}
		]
	},
	{
		"name": "solid_depth_levels",
		"lod": 4,
		"internalFormat": "GL_R32F",
		"pixelFormat": "RED",
		"pixelDataType": "FLOAT",
		"texParams": [
			{ "name": "TEXTURE_MIN_FILTER", "val": "NEAREST_MIPMAP_NEAREST"},
			{ "name": "TEXTURE_MAG_FILTER", "val": "NEAREST"},
			{ "name": "TEXTURE_WRAP_S", "val": "CLAMP_TO_EDGE"},
			{ "name": "TEXTURE_WRAP_T", "val": "CLAMP_TO_EDGE"}
		]
	},
	{
		"name": "lag_finder",
		"internalFormat": "GL_RGBA32F",
		"pixelFormat": "RGBA",
		"pixelDataType": "FLOAT",
		"texParams": [
			{ "name": "TEXTURE_MIN_FILTER", "val": "NEAREST" },
			{ "name": "TEXTURE_MAG_FILTER", "val": "NEAREST" },
			{ "name": "TEXTURE_WRAP_S", "val": "CLAMP_TO_EDGE" },
			{ "name": "TEXTURE_WRAP_T", "val": "CLAMP_TO_EDGE" }
		]
	}
],

"framebuffers": [
	{
		"name": "solid",
		"colorAttachments": [
			{ "image": "solid", "clearColor": "c:" }
		]
	},
	{
		"name": "solid_with_depth",
		"colorAttachments": [
			{ "image": "solid", "clearColor": "c:" }
		],
		"depthAttachment": { "image": "solid_depth", "clearDepth": "c:" }
	},
	{
		"name": "solid_with_depth_and_normal",
		"colorAttachments": [
			{ "image": "solid", "clearColor": "c:" },
			{ "image": "solid_normal", "clearColor": "c:" }
		],
		"depthAttachment": { "image": "solid_depth", "clearDepth": "c:" }
	},
	{
		"name": "translucent_0_cd",
		"colorAttachments": [
			{ "image": "translucent_0", "clearColor": "c:" }
		],
		"depthAttachment": { "image": "translucent_0_depth", "clearDepth": "c:" }
	},
	{
		"name": "translucent_0_cnd",
		"colorAttachments": [
			{ "image": "translucent_0", "clearColor": "c:" },
			{ "image": "translucent_0_normal", "clearColor": "c:" }
		],
		"depthAttachment": { "image": "translucent_0_depth", "clearDepth": "c:" }
	},
	{
		"name": "translucent_1_cd",
		"colorAttachments": [
			{ "image": "translucent_1", "clearColor": "c:" }
		],
		"depthAttachment": { "image": "translucent_1_depth", "clearDepth": "c:" }
	},
	{
		"name": "translucent_1_cnd",
		"colorAttachments": [
			{ "image": "translucent_1", "clearColor": "c:" },
			{ "image": "translucent_1_normal", "clearColor": "c:" }
		],
		"depthAttachment": { "image": "translucent_1_depth", "clearDepth": "c:" }
	},
	{
		"name": "sorted",
		"colorAttachments": [
			{ "image": "sorted", "clearColor": "c:" },
			{ "image": "sorted_depth", "clearColor": 4294967295 },
			{ "image": "sorted_normal", "clearColor": "c:" }
		]
	},
	{
		"name": "depth_level_0",
		"colorAttachments": [
			{ "image": "depth_levels", "lod": 0 },
			{ "image": "solid_depth_levels", "lod": 0 }
		]
	},
	{
		"name": "depth_level_1",
		"colorAttachments": [
			{ "image": "depth_levels", "lod": 1 },
			{ "image": "solid_depth_levels", "lod": 1 }
		]
	},
	{
		"name": "depth_level_2",
		"colorAttachments": [
			{ "image": "depth_levels", "lod": 2 },
			{ "image": "solid_depth_levels", "lod": 2 }
		]
	},
	{
		"name": "depth_level_3",
		"colorAttachments": [
			{ "image": "depth_levels", "lod": 3 },
			{ "image": "solid_depth_levels", "lod": 3 }
		]
	},
	{
		"name": "depth_level_4",
		"colorAttachments": [
			{ "image": "depth_levels", "lod": 4 },
			{ "image": "solid_depth_levels", "lod": 4 }
		]
	},
	{
		"name": "post_result",
		"colorAttachments": [
			{ "image": "post_result", "clearColor": "c:" }, { "image": "lag_finder", "clearColor": "c:" }
		]
	}
],

"beforeWorldRender": {
	"passes": [
		{ "name": "clear_solid", "framebuffer": "solid_with_depth_and_normal", "program": "frex_clear" },
		{ "name": "clear_translucent_0_cnd", "framebuffer": "translucent_0_cnd", "program": "frex_clear" },
		{ "name": "clear_translucent_1_cnd", "framebuffer": "translucent_1_cnd", "program": "frex_clear" }
	]
}

}